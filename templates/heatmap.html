{% extends 'base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Çağrı Yoğunluk Haritası (15 Dk)</h2>
    <form class="d-flex gap-2" method="get">
        <select name="queue_id" class="form-select" onchange="this.form.submit()">
            <option value="">Tüm Kuyruklar</option>
            {% for q in queues %}
            <option value="{{ q.id }}" {% if selected_queue_id == q.id %}selected{% endif %}>{{ q.name }}</option>
            {% endfor %}
        </select>
        <input type="date" name="start_date" class="form-control" value="{{ start_date }}">
        <input type="date" name="end_date" class="form-control" value="{{ end_date }}">
        <button type="submit" class="btn btn-primary">Filtrele</button>
    </form>
</div>

<div class="card p-0" style="overflow-x: auto; max-width: 100%;">
    <div style="min-width: 3000px;"> <!-- Force scroll -->
        <table class="table table-dark table-sm table-bordered text-center mb-0" style="font-size: 10px;">
            <thead>
                <tr>
                    <th style="position: sticky; left: 0; background: #1e293b; z-index: 10; min-width: 100px;">Tarih
                    </th>
                    <th style="min-width: 60px;">Toplam</th>
                    {% for h in time_headers %}
                    <th style="min-width: 35px;">{{ h }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for row in table_rows %}
                <tr>
                    <th style="position: sticky; left: 0; background: #1e293b; z-index: 10;">{{ row.date|date:"D d M" }}
                    </th>
                    <td class="fw-bold text-warning">{{ row.total }}</td>
                    {% for cell in row.cells %}
                    <td class="
                        {% if cell > 40 %}bg-danger text-white
                        {% elif cell > 20 %}bg-warning text-dark
                        {% elif cell > 10 %}bg-info text-dark
                        {% elif cell > 0 %}bg-success text-white
                        {% else %}text-muted{% endif %}
                    ">
                        {% if cell > 0 %}{{ cell }}{% else %}<span style="opacity:0.1">.</span>{% endif %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="mt-3 text-muted small">
    <span class="badge bg-success me-1">1-10</span> Düşük
    <span class="badge bg-info me-1">11-20</span> Orta
    <span class="badge bg-warning me-1">21-40</span> Yüksek
    <span class="badge bg-danger">41+</span> Kritik
</div>
{% endblock %}
{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-4">
        <div class="card p-4">
            <h3 class="text-center mb-4">Giriş Yap</h3>
            <form method="post">
                {% csrf_token %}
                {{ form|crispy }}
                <button type="submit" class="btn btn-primary w-100 mt-3">Giriş</button>
            </form>
            {% if is_public_tenant %}
            <hr>
            <div class="text-center">
                <p class="mb-2">Yeni Müşteri misiniz?</p>
                <a href="{% url 'pricing' %}" class="btn btn-success w-100 mb-2">Paketleri İncele & Kayıt Ol</a>

                <hr class="my-3">

                <p class="mb-2 small text-muted">Mevcut Müşteri Girişi</p>
                <div class="input-group mb-3">
                    <span class="input-group-text" id="basic-addon3">https://</span>
                    <input type="text" class="form-control" id="tenantInput" placeholder="şirketadı"
                        aria-describedby="basic-addon3">
                    <span class="input-group-text" id="domainSuffix">.wfm-pro.com</span>
                </div>
                <button onclick="goToTenant()" class="btn btn-outline-light w-100 btn-sm">Panele Git</button>
            </div>

            <script>
                // Visuals strictly requested to be .wfm-pro.com
                // We do NOT overwrite this with .localhost in the UI anymore.

                function goToTenant() {
                    const tenant = document.getElementById('tenantInput').value;
                    if (tenant) {
                        const protocol = window.location.protocol;
                        const host = window.location.hostname;
                        const port = window.location.port;

                        // Functionally, we still need to work on the current machine
                        let targetHost = `${tenant}.wfm-pro.com`;

                        // If we are actually developing on localhost, we must preserve functionality
                        // effectively "spoofing" the redirect to work in this env
                        if (host.includes('localhost') || host.includes('127.0.0.1')) {
                            targetHost = `${tenant}.localhost`;
                            if (port) {
                                targetHost += `:${port}`;
                            }
                        }

                        window.location.href = `${protocol}//${targetHost}/login/`;
                    }
                }
            </script>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}